<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ayan Water Tank</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --primary: #f85606; --bg: #f1f3f6; --text: #212121; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* HEADER */
        header { background: var(--primary); padding: 10px 15px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .brand { display: flex; align-items: center; gap: 10px; color: white; font-weight: 600; font-size: 16px; }
        .logo { width: 35px; height: 35px; border-radius: 50%; border: 2px solid white; }

        /* HERO BANNER */
        .hero-section {
            background: white; margin: 10px; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .hero-title { margin: 0 0 5px 0; font-size: 18px; font-weight: 700; color: #333; }
        .hero-sub { font-size: 12px; color: #777; display: block; margin-bottom: 10px; }
        .hero-img { width: 150px; height: auto; border-radius: 10px; object-fit: cover; display: inline-block; }
        
        /* PRODUCT GRID */
        .page { display: none; padding: 10px; }
        .page.active { display: block; }
        
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* CARD STYLING */
        .product-card { background: white; padding: 8px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; }
        .img-box { height: 120px; width: 100%; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; background: #fff; border-bottom: 1px solid #f0f0f0; }
        .product-img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .title { font-size: 13px; font-weight: 500; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #333; }
        .price { color: var(--primary); font-weight: 700; font-size: 14px; margin-bottom: 6px; }
        .btn-view { background: var(--primary); color: white; border: none; padding: 6px; border-radius: 4px; width: 100%; margin-top: auto; font-size: 12px; cursor: pointer; }

        /* DETAIL MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; overflow-y: auto; }
        .modal-content { width: 100%; background: white; padding-bottom: 80px; }
        .close-detail-btn { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.1); border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; }
        
        .detail-main-img-box { width: 100%; height: 300px; background: #fff; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #eee; position: relative; }
        #d-main-img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .gallery-row { display: flex; gap: 8px; padding: 10px; overflow-x: auto; background: white; border-bottom: 1px solid #f1f1f1; white-space: nowrap; }
        .gallery-thumb { width: 60px; height: 60px; border: 1px solid #ddd; border-radius: 5px; object-fit: cover; cursor: pointer; flex-shrink: 0; }

        .detail-info { padding: 15px; }
        .detail-price { font-size: 22px; color: var(--primary); font-weight: 700; margin-bottom: 5px; }
        .detail-title { font-size: 16px; color: #333; font-weight: 400; line-height: 1.4; margin-bottom: 15px; }
        
        .payment-methods-box { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .pay-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-size: 14px; }

        .detail-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 10px 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; gap: 10px; }
        .btn-buy-now { background: var(--primary); color: white; border: none; width: 100%; padding: 12px; font-size: 16px; font-weight: bold; border-radius: 30px; cursor: pointer; }

        /* CHECKOUT MODAL */
        .checkout-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; align-items: center; justify-content: center; }
        .checkout-box { background: white; width: 90%; max-width: 350px; padding: 20px; border-radius: 10px; position: relative; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; }
        
        /* NAV */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 8px 0; border-top: 1px solid #eee; z-index: 900; }
        .nav-item { font-size: 10px; color: #777; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--primary); font-weight: 600; }
        .nav-item i { font-size: 18px; margin-bottom: 2px; }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <img src="https://i.ibb.co/Z692Xs4C/IMG-20251120-WA0001.jpg" class="logo">
            <span>Ayan Water Tank</span>
        </div>
        <i class="fas fa-shopping-cart" style="color:white"></i>
    </header>

    <div id="home" class="page active">
        <div class="hero-section">
            <h2 class="hero-title">Best Water Tanks</h2>
            <span class="hero-sub">Durable & Strong</span>
            <img src="https://i.ibb.co/Z692Xs4C/IMG-20251120-WA0001.jpg" alt="Best Tank" class="hero-img">
        </div>

        <div style="display:flex; justify-content:space-between; padding:0 5px; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0; font-size:16px;">Featured Products</h3>
            <span onclick="showPage('products')" style="color:var(--primary); font-size:12px; cursor:pointer;">View All</span>
        </div>

        <div id="home-products" class="product-grid"><p style="text-align:center; width:200%;">Loading...</p></div>
    </div>

    <!-- PRODUCTS PAGE -->
    <div id="products" class="page">
        <h3 style="margin-top:0; font-size:16px;">All Products</h3>
        <div id="all-products" class="product-grid"><p style="text-align:center; width:200%;">Loading...</p></div>
    </div>

    <!-- CONTACT PAGE -->
    <div id="contact" class="page">
        <div style="background:white; padding:20px; border-radius:10px; text-align:center;">
            <h3>Contact Us</h3>
            <p style="margin-bottom:20px;"><strong>Address:</strong> Karachi, Landhi No 6</p>
            
            <!-- Contact Number 1 -->
            <div style="margin-bottom: 15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                <p style="margin:0; font-weight:bold; color:#555;">Number 1</p>
                <p style="margin:5px 0; font-size:16px;">0315-2756105</p>
                <a href="tel:03152756105"><button class="btn-view" style="padding:8px 20px; width:auto; background:green;">Call Now</button></a>
            </div>

            <!-- Contact Number 2 -->
            <div>
                <p style="margin:0; font-weight:bold; color:#555;">Number 2</p>
                <p style="margin:5px 0; font-size:16px;">0323-0201714</p>
                <a href="tel:03230201714"><button class="btn-view" style="padding:8px 20px; width:auto; background:green;">Call Now</button></a>
            </div>
        </div>
    </div>

    <!-- DETAIL MODAL -->
    <div id="detail-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="close-detail-btn" onclick="closeDetail()"><i class="fas fa-arrow-left"></i></div>
            <div class="detail-main-img-box">
                <img id="d-main-img" src="" alt="Main">
            </div>
            <div class="gallery-row" id="d-gallery"></div>
            <div class="detail-info">
                <div id="d-price" class="detail-price">Rs. 0</div>
                <div id="d-name" class="detail-title">Product Name</div>
                <div class="payment-methods-box">
                    <h4>Payment Methods</h4>
                    <div class="pay-row"><i class="fas fa-hand-holding-usd"></i> Cash on Delivery</div>
                    <!-- Easypaisa OLD Number as requested -->
                    <div class="pay-row"><i class="fas fa-mobile-alt" style="color:green;"></i> Easypaisa (0323-0201714)</div>
                    <div class="pay-row"><i class="fas fa-university" style="color:#f85606;"></i> Bank Transfer</div>
                </div>
            </div>
            <div class="detail-footer">
                <button class="btn-buy-now" onclick="openCheckout()">Buy Now</button>
            </div>
        </div>
    </div>

    <!-- CHECKOUT MODAL -->
    <div id="checkout-modal" class="checkout-overlay">
        <div class="checkout-box">
            <div style="text-align:right;"><i class="fas fa-times" onclick="closeCheckout()" style="cursor:pointer; font-size:20px;"></i></div>
            <h3>Order Details</h3>
            <p id="c-info" style="color:#777; font-size:12px; margin-bottom:15px;"></p>
            <input id="c-name" class="form-input" placeholder="Full Name">
            <input id="c-phone" class="form-input" placeholder="Phone Number">
            <input id="c-addr" class="form-input" placeholder="Delivery Address">
            <button class="btn-view" style="padding:12px; font-size:16px;" onclick="submitOrder()">Confirm Order</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home', this)"><i class="fas fa-home"></i>Home</div>
        <div class="nav-item" onclick="showPage('products', this)"><i class="fas fa-box"></i>Shop</div>
        <div class="nav-item" onclick="showPage('contact', this)"><i class="fas fa-phone"></i>Contact</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCvdIFYFHo-cUkgf_W1iZazWdlW8UCpIRI",
            authDomain: "ayan-133d3.firebaseapp.com",
            databaseURL: "https://ayan-133d3-default-rtdb.firebaseio.com",
            projectId: "ayan-133d3",
            storageBucket: "ayan-133d3.appspot.com",
            messagingSenderId: "172561324990",
            appId: "1:172561324990:web:8fd98a21658c4c199777ef"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let selectedProduct = {};

        // --- SAFE MODE DATA LOADING ---
        db.ref('products').on('value', (snapshot) => {
            const hGrid = document.getElementById('home-products');
            const aGrid = document.getElementById('all-products');
            const data = snapshot.val();

            if(hGrid) hGrid.innerHTML = ""; 
            if(aGrid) aGrid.innerHTML = "";

            if(data) {
                Object.entries(data).forEach(([key, prod]) => {
                    let firstImg = prod.image ? prod.image.split(',')[0] : '';
                    let displayPrice = (prod.price && prod.price !== "null") ? prod.price : "0";

                    const card = document.createElement('div');
                    card.className = 'product-card';
                    
                    const imgBox = document.createElement('div');
                    imgBox.className = 'img-box';
                    const img = document.createElement('img');
                    img.src = firstImg;
                    img.className = 'product-img';
                    img.onerror = function(){ this.src = 'https://via.placeholder.com/150?text=No+Image'; };
                    imgBox.appendChild(img);

                    const title = document.createElement('div');
                    title.className = 'title';
                    title.innerText = prod.name;

                    const priceDiv = document.createElement('div');
                    priceDiv.className = 'price';
                    priceDiv.innerText = "Rs. " + displayPrice;

                    const btn = document.createElement('button');
                    btn.className = 'btn-view';
                    btn.innerText = 'View Details';

                    card.appendChild(imgBox);
                    card.appendChild(title);
                    card.appendChild(priceDiv);
                    card.appendChild(btn);

                    card.onclick = function() { openDetail(prod); };

                    if(hGrid) hGrid.appendChild(card);
                    const card2 = card.cloneNode(true);
                    card2.onclick = function() { openDetail(prod); };
                    if(aGrid) aGrid.appendChild(card2);
                });
            } else {
                if(hGrid) hGrid.innerHTML = "<p style='grid-column:span 2; text-align:center;'>No products yet</p>";
            }
        });

        function openDetail(prod) {
            selectedProduct = prod;
            let displayPrice = (prod.price && prod.price !== "null") ? prod.price : "0";
            let imgs = prod.image ? prod.image.split(',') : [];

            document.getElementById('d-name').innerText = prod.name;
            document.getElementById('d-price').innerText = "Rs. " + displayPrice;
            document.getElementById('d-main-img').src = imgs[0] || '';

            const gal = document.getElementById('d-gallery');
            gal.innerHTML = "";
            imgs.forEach(url => {
                let img = document.createElement('img');
                img.src = url;
                img.className = 'gallery-thumb';
                img.onclick = function() { document.getElementById('d-main-img').src = url; };
                gal.appendChild(img);
            });
            document.getElementById('detail-modal').style.display = 'block';
        }

        function closeDetail() { document.getElementById('detail-modal').style.display = 'none'; }
        
        function openCheckout() {
            document.getElementById('c-info').innerText = selectedProduct.name + " - Rs. " + selectedProduct.price;
            document.getElementById('checkout-modal').style.display = 'flex';
        }
        function closeCheckout() { document.getElementById('checkout-modal').style.display = 'none'; }
        
        function submitOrder() {
            const name = document.getElementById('c-name').value;
            const phone = document.getElementById('c-phone').value;
            const addr = document.getElementById('c-addr').value;
            if(!name || !phone || !addr) { alert("Please fill all details"); return; }
            
            db.ref('orders').push({
                customerName: name, customerPhone: phone, customerAddress: addr,
                product: selectedProduct.name + " (Rs. " + selectedProduct.price + ")",
                timestamp: new Date().toLocaleString()
            }).then(() => { alert("Order Placed!"); location.reload(); });
        }

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                el.classList.add('active');
            }
        }
    </script>
</body>
</html>